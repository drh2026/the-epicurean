<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Epicurean — Charles Ranhofer · Delmonico's · 1894</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=IM+Fell+English:ital@0;1&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,500&family=Cinzel:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --midnight:#0a0d14; --navy:#111827; --navy-lt:#1a2436;
  --gold:#c9a84c; --gold-lt:#e8c97e; --gold-dim:#7a6030;
  --ivory:#f5efe0; --ivory-dim:#b8af9a; --claret:#6b1a2a;
  --border:rgba(201,168,76,.2); --border-s:rgba(201,168,76,.48);
  --shadow:0 12px 60px rgba(0,0,0,.75);
  --fd:'Cinzel',serif; --ft:'Playfair Display',serif;
  --fb:'Cormorant Garamond',serif; --fi:'IM Fell English',serif;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{background:var(--midnight);color:var(--ivory);font-family:var(--fb);font-size:18px;line-height:1.6;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.035'/%3E%3C/svg%3E");pointer-events:none;z-index:999;opacity:.6}

/* LOADING */
#ls{position:fixed;inset:0;background:var(--midnight);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9000;transition:opacity .8s,visibility .8s}
#ls.hidden{opacity:0;visibility:hidden;pointer-events:none}
.lm{width:72px;height:72px;border:1px solid var(--gold-dim);border-top-color:var(--gold);border-radius:50%;animation:spin 1.8s linear infinite;margin-bottom:2rem;position:relative}
.lm::after{content:'✦';position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:var(--gold);font-size:1.3rem;animation:spin 1.8s linear infinite reverse}
@keyframes spin{to{transform:rotate(360deg)}}
.lt{font-family:var(--fd);font-size:clamp(.9rem,2.5vw,1.2rem);letter-spacing:.35em;color:var(--gold);text-transform:uppercase;margin-bottom:.4rem}
.ls{font-family:var(--fi);font-style:italic;color:var(--ivory-dim);font-size:.95rem}
.lbw{width:220px;height:1px;background:var(--border);margin-top:1.8rem}
.lb{height:100%;background:linear-gradient(90deg,var(--gold-dim),var(--gold));width:0;transition:width .3s}

/* HEADER */
#hdr{position:relative;text-align:center;padding:clamp(3rem,8vw,6rem) 2rem clamp(2rem,5vw,3.5rem);border-bottom:1px solid var(--border);overflow:hidden}
#hdr::before,#hdr::after{content:'';position:absolute;width:160px;height:160px;border:1px solid var(--border);opacity:.4}
#hdr::before{top:1rem;left:1rem;border-right:none;border-bottom:none}
#hdr::after{top:1rem;right:1rem;border-left:none;border-bottom:none}
.h-eyebrow{font-family:var(--fd);font-size:clamp(.5rem,1.3vw,.65rem);letter-spacing:.45em;color:var(--gold-dim);text-transform:uppercase;margin-bottom:1.4rem}
.h-title{font-family:var(--fd);font-size:clamp(2.2rem,8vw,5.5rem);font-weight:700;letter-spacing:.12em;color:var(--gold);text-transform:uppercase;line-height:1;text-shadow:0 0 80px rgba(201,168,76,.18)}
.h-rule{display:flex;align-items:center;justify-content:center;gap:1rem;margin:1.2rem auto;max-width:380px}
.h-rl{flex:1;height:1px;background:var(--border-s)}
.h-ro{color:var(--gold);font-size:.75rem;letter-spacing:.3em}
.h-sub{font-family:var(--fi);font-style:italic;font-size:clamp(.9rem,2.3vw,1.25rem);color:var(--ivory-dim);letter-spacing:.04em;margin-bottom:.3rem}
.h-by{font-family:var(--fd);font-size:clamp(.5rem,1.1vw,.6rem);letter-spacing:.4em;color:var(--gold-dim);text-transform:uppercase;margin-top:1.4rem}
.h-stats{display:flex;align-items:center;justify-content:center;gap:1.8rem;margin-top:1.8rem;flex-wrap:wrap}
.stat-n{font-family:var(--ft);font-size:1.5rem;font-weight:700;color:var(--gold);display:block;line-height:1}
.stat-l{font-family:var(--fd);font-size:.48rem;letter-spacing:.35em;color:var(--ivory-dim);text-transform:uppercase;margin-top:.25rem;display:block}
.stat-div{color:var(--border-s)}

/* NAV */
#nav{position:sticky;top:0;background:rgba(10,13,20,.97);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);z-index:200;padding:0 1rem}
.nav-i{max-width:1200px;margin:0 auto;display:flex;align-items:stretch;justify-content:center}
.ntab{font-family:var(--fd);font-size:clamp(.48rem,1.1vw,.58rem);letter-spacing:.28em;text-transform:uppercase;color:var(--ivory-dim);background:none;border:none;border-bottom:2px solid transparent;padding:1.1rem clamp(.7rem,1.8vw,1.6rem);cursor:pointer;transition:color .2s,border-color .2s;white-space:nowrap}
.ntab:hover{color:var(--ivory)}
.ntab.active{color:var(--gold);border-bottom-color:var(--gold)}

/* SEARCH */
#srch-wrap{display:none;max-width:700px;margin:0 auto;padding:2.5rem 1.5rem 1.5rem}
#srch-wrap.vis{display:block}
.sf-wrap{position:relative}
.si{position:absolute;left:1.1rem;top:50%;transform:translateY(-50%);color:var(--gold-dim);font-size:1rem;pointer-events:none}
#srch{width:100%;background:var(--navy-lt);border:1px solid var(--border);border-radius:2px;color:var(--ivory);font-family:var(--fb);font-size:1rem;padding:.8rem 1rem .8rem 2.7rem;outline:none;transition:border-color .2s;letter-spacing:.02em}
#srch:focus{border-color:var(--border-s)}
#srch::placeholder{color:var(--ivory-dim);opacity:.45}
#srch-ct{font-family:var(--fd);font-size:.52rem;letter-spacing:.3em;color:var(--ivory-dim);text-transform:uppercase;margin-top:.7rem;text-align:right;min-height:1.2em}
.frb{display:none;align-items:center;gap:.5rem;font-family:var(--fi);font-style:italic;font-size:.8rem;color:var(--gold-dim);margin-top:.4rem}
.frb.vis{display:flex}
.frd{width:6px;height:6px;background:var(--gold);border-radius:50%;animation:pd 1.5s ease infinite}
@keyframes pd{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.3;transform:scale(.55)}}

/* MAIN */
#main{max-width:1300px;margin:0 auto;padding:0 clamp(1rem,3vw,2.5rem)}

/* BROWSE */
#browse-panel{padding:3rem 0}
.br-intro{text-align:center;padding:0 0 2.5rem}
.br-intro p{font-family:var(--fi);font-style:italic;color:var(--ivory-dim);font-size:1rem;max-width:520px;margin:0 auto;line-height:1.75}
.sgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:1px;border:1px solid var(--border)}
.scard{background:var(--navy);padding:1.7rem 1.4rem;cursor:pointer;transition:background .18s;border:none;text-align:left;position:relative;overflow:hidden}
.scard::before{content:'';position:absolute;top:0;left:0;width:2px;height:0;background:var(--gold);transition:height .22s}
.scard:hover{background:var(--navy-lt)}
.scard:hover::before{height:100%}
.sn{font-family:var(--fd);font-size:clamp(.5rem,1.1vw,.6rem);letter-spacing:.28em;color:var(--gold);text-transform:uppercase;display:block;margin-bottom:.5rem}
.sfr{font-family:var(--fi);font-style:italic;color:var(--ivory-dim);font-size:.88rem;display:block;margin-bottom:.7rem;line-height:1.3}
.sc{font-family:var(--ft);font-size:1.7rem;font-weight:700;color:var(--ivory);opacity:.12;display:block;line-height:1;transition:opacity .18s}
.scard:hover .sc{opacity:.3}

/* AZ */
#az-panel{display:none;padding:2.5rem 0}
#az-panel.vis{display:block}
.az-strip{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:2.5rem;border-bottom:1px solid var(--border);padding-bottom:1.5rem}
.azb{font-family:var(--fd);font-size:.6rem;letter-spacing:.18em;width:36px;height:36px;border:1px solid var(--border);background:none;color:var(--ivory-dim);cursor:pointer;transition:all .15s;text-transform:uppercase}
.azb:hover:not(.empty){border-color:var(--gold);color:var(--gold)}
.azb.act{background:var(--gold);color:var(--midnight);border-color:var(--gold)}
.azb.empty{opacity:.2;cursor:default}

/* TAXONOMY */
#tax-panel{display:none;padding:2.5rem 0}
#tax-panel.vis{display:block}
.ttabs{display:flex;gap:1px;border-bottom:1px solid var(--border);margin-bottom:1.8rem}
.ttab{font-family:var(--fi);font-style:italic;font-size:1.05rem;color:var(--ivory-dim);background:none;border:none;border-bottom:2px solid transparent;padding:.6rem 1.4rem;cursor:pointer;transition:color .2s;margin-bottom:-1px}
.ttab:hover{color:var(--ivory)}
.ttab.act{color:var(--gold);border-bottom-color:var(--gold)}
.tdesc{font-family:var(--fi);font-style:italic;font-size:.86rem;color:var(--ivory-dim);margin-bottom:1.4rem;line-height:1.65;max-width:540px}
.mcloud{display:flex;flex-wrap:wrap;gap:7px;margin-bottom:2rem}
.mchip{font-family:var(--fi);font-style:italic;background:none;border:1px solid var(--border);color:var(--ivory-dim);padding:.3rem .8rem;cursor:pointer;border-radius:1px;transition:all .15s;line-height:1.3}
.mchip:hover{border-color:var(--gold);color:var(--gold)}
.mchip.act{background:rgba(201,168,76,.1);border-color:var(--gold);color:var(--gold)}
.fh{font-size:1.05rem}.fm{font-size:.9rem}.fl{font-size:.76rem}

/* RESULTS */
#res-panel,.res-inner{padding-bottom:3rem}
.rh{display:flex;align-items:baseline;justify-content:space-between;flex-wrap:wrap;gap:.5rem;padding:1.5rem 0 1rem;border-bottom:1px solid var(--border);margin-bottom:1.5rem}
.rl{font-family:var(--fd);font-size:.52rem;letter-spacing:.35em;color:var(--gold);text-transform:uppercase}
.rc{font-family:var(--fi);font-style:italic;color:var(--ivory-dim);font-size:.86rem}
.rlist{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1px;background:var(--border)}
.rcard{background:var(--navy);padding:1.3rem 1.4rem;cursor:pointer;border:none;text-align:left;transition:background .14s;position:relative}
.rcard:hover{background:var(--navy-lt)}
.rcard:hover .rno{color:var(--gold)}
.rno{font-family:var(--fd);font-size:.5rem;letter-spacing:.28em;color:var(--gold-dim);text-transform:uppercase;display:block;margin-bottom:.35rem;transition:color .14s}
.rfr{font-family:var(--fi);font-style:italic;font-size:.98rem;color:var(--ivory);display:block;line-height:1.35;margin-bottom:.2rem}
.ren{font-family:var(--fb);font-size:.8rem;color:var(--ivory-dim);display:block;line-height:1.3}
.rtag{display:inline-block;margin-top:.6rem;font-family:var(--fd);font-size:.42rem;letter-spacing:.28em;text-transform:uppercase;color:var(--gold-dim);border:1px solid var(--border);padding:.12rem .45rem}

/* PAGINATION */
.pages{display:flex;align-items:center;justify-content:center;gap:.4rem;padding:2rem 0 1rem;flex-wrap:wrap}
.pb{font-family:var(--fd);font-size:.52rem;letter-spacing:.18em;min-width:34px;height:34px;border:1px solid var(--border);background:none;color:var(--ivory-dim);cursor:pointer;transition:all .14s;text-transform:uppercase;padding:0 .5rem}
.pb:hover:not(:disabled){border-color:var(--gold);color:var(--gold)}
.pb.act{background:var(--gold);color:var(--midnight);border-color:var(--gold)}
.pb:disabled{opacity:.25;cursor:default}
.pe{color:var(--ivory-dim);font-size:.8rem}

/* MODAL */
#mo{position:fixed;inset:0;background:rgba(10,13,20,.92);backdrop-filter:blur(6px);z-index:500;display:none;align-items:center;justify-content:center;padding:1.5rem}
#mo.open{display:flex}
#mdl{background:var(--navy);border:1px solid var(--border-s);max-width:740px;width:100%;max-height:88vh;overflow-y:auto;position:relative;box-shadow:var(--shadow);animation:mi .22s ease}
@keyframes mi{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:none}}
.mhdr{padding:1.8rem 1.8rem 1.1rem;border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--navy);z-index:10}
.mno{font-family:var(--fd);font-size:.52rem;letter-spacing:.35em;color:var(--gold-dim);text-transform:uppercase;display:block;margin-bottom:.55rem}
.mfr{font-family:var(--ft);font-size:clamp(1.05rem,3vw,1.55rem);font-style:italic;color:var(--ivory);display:block;line-height:1.3;margin-bottom:.3rem}
.men{font-family:var(--fb);font-size:.88rem;color:var(--ivory-dim);display:block}
.msec{display:inline-block;margin-top:.7rem;font-family:var(--fd);font-size:.45rem;letter-spacing:.28em;text-transform:uppercase;color:var(--gold-dim);border:1px solid var(--border);padding:.18rem .55rem}
.mbody{padding:1.7rem 1.8rem 1.8rem}
.mtxt{font-family:var(--fb);font-size:1.02rem;line-height:1.78;color:var(--ivory-dim);white-space:pre-wrap}
.mtxt.ld{font-style:italic;opacity:.45;text-align:center;padding:1rem 0}
.mcls{position:absolute;top:1rem;right:1rem;width:30px;height:30px;background:none;border:1px solid var(--border);color:var(--ivory-dim);font-size:.95rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s;font-family:sans-serif}
.mcls:hover{border-color:var(--gold);color:var(--gold)}
.mnav{display:flex;justify-content:space-between;padding:.9rem 1.8rem 1.3rem;border-top:1px solid var(--border);gap:.8rem}
.mnb{font-family:var(--fd);font-size:.48rem;letter-spacing:.22em;text-transform:uppercase;color:var(--ivory-dim);background:none;border:1px solid var(--border);padding:.45rem .9rem;cursor:pointer;transition:all .14s;flex:1;text-align:center}
.mnb:hover:not(:disabled){border-color:var(--gold);color:var(--gold)}
.mnb:disabled{opacity:.22;cursor:default}

/* FOOTER */
#ftr{border-top:1px solid var(--border);padding:2.5rem 2rem;text-align:center;margin-top:2rem}
.fo{color:var(--gold-dim);letter-spacing:.5em;font-size:.65rem;margin-bottom:.9rem}
.ft{font-family:var(--fi);font-style:italic;color:var(--ivory-dim);font-size:.82rem;line-height:1.8;max-width:460px;margin:0 auto}

/* UTIL */
.hidden{display:none!important}
mark{background:rgba(201,168,76,.22);color:var(--gold);padding:0 2px;border-radius:1px}
::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-track{background:var(--midnight)}
::-webkit-scrollbar-thumb{background:var(--gold-dim);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--gold)}

@media(max-width:640px){
  .sgrid,.rlist{grid-template-columns:1fr 1fr}
  #mdl{max-height:95vh}
  .mhdr,.mbody,.mnav{padding-left:1.1rem;padding-right:1.1rem}
  .ntab{padding:1rem .55rem}
  .h-stats{gap:1rem}
}
</style>
</head>
<body>

<div id="ls">
  <div class="lm"></div>
  <div class="lt">The Epicurean</div>
  <div class="ls" id="ls-sub">Consulting the archive…</div>
  <div class="lbw"><div class="lb" id="lb"></div></div>
</div>

<header id="hdr">
  <div class="h-eyebrow">Delmonico's · New York · Established 1827</div>
  <h1 class="h-title">The Epicurean</h1>
  <div class="h-rule"><div class="h-rl"></div><div class="h-ro">✦ ✦ ✦</div><div class="h-rl"></div></div>
  <div class="h-sub">A Complete Treatise of Analytical and Practical Studies on the Culinary Art</div>
  <div class="h-by">Charles Ranhofer · Chef of Delmonico's · 1836–1899</div>
  <div class="h-stats">
    <div class="stat"><span class="stat-n" id="stat-r">—</span><span class="stat-l">Recipes</span></div>
    <span class="stat-div">·</span>
    <div class="stat"><span class="stat-n">23</span><span class="stat-l">Chapters</span></div>
    <span class="stat-div">·</span>
    <div class="stat"><span class="stat-n">1894</span><span class="stat-l">First Edition</span></div>
  </div>
</header>

<nav id="nav">
  <div class="nav-i">
    <button class="ntab active" onclick="setMode('browse')" id="tab-browse">Browse Chapters</button>
    <button class="ntab" onclick="setMode('search')" id="tab-search">Search Archive</button>
    <button class="ntab" onclick="setMode('az')" id="tab-az">A–Z Index</button>
    <button class="ntab" onclick="setMode('tax')" id="tab-tax">À la · Au · En</button>
  </div>
</nav>

<main id="main">

  <div id="srch-wrap">
    <div class="sf-wrap">
      <span class="si">⌕</span>
      <input id="srch" type="search" placeholder="Search titles, French names, or recipe number…" autocomplete="off" spellcheck="false">
    </div>
    <div id="srch-ct"></div>
    <div class="frb" id="frb"><span class="frd"></span>Matched on French title</div>
  </div>

  <div id="browse-panel">
    <div class="br-intro">
      <p>Twenty-three chapters spanning the full range of haute cuisine as practised at Delmonico's — from fundamental preparations to the grandest cold service.</p>
    </div>
    <div class="sgrid" id="sgrid"></div>
  </div>

  <div id="az-panel">
    <div class="az-strip" id="az-strip"></div>
    <div id="az-res"></div>
  </div>

  <div id="tax-panel">
    <div class="ttabs">
      <button class="ttab act" onclick="setTaxTab('a_la')" id="tt-a_la">à la</button>
      <button class="ttab" onclick="setTaxTab('au_aux')" id="tt-au_aux">au / aux</button>
      <button class="ttab" onclick="setTaxTab('en_method')" id="tt-en_method">en</button>
    </div>
    <div class="tdesc" id="tdesc"></div>
    <div class="mcloud" id="mcloud"></div>
    <div id="tax-res"></div>
  </div>

  <div id="res-panel" style="display:none">
    <div id="res-inner"></div>
  </div>

</main>

<div id="mo" onclick="closeMO(event)">
  <div id="mdl" role="dialog">
    <button class="mcls" onclick="closeM()">✕</button>
    <div class="mhdr">
      <span class="mno" id="m-no"></span>
      <span class="mfr" id="m-fr"></span>
      <span class="men" id="m-en"></span>
      <span class="msec" id="m-sec"></span>
    </div>
    <div class="mbody"><div class="mtxt" id="m-txt"></div></div>
    <div class="mnav">
      <button class="mnb" id="m-prv" onclick="mNav(-1)">← Previous</button>
      <button class="mnb" id="m-nxt" onclick="mNav(1)">Next →</button>
    </div>
  </div>
</div>

<footer id="ftr">
  <div class="fo">— ✦ —</div>
  <div class="ft"><em>The Epicurean</em> was published in 1894 by Charles Ranhofer, Chef of Delmonico's for thirty-four years. This digital archive presents all 3,186 recipes with their original French and English titles as printed in the first edition.</div>
</footer>

<script>
let DB=null,TEXTS={},mode='browse',curRes=[],curPg=1,curMIdx=-1,sTmr=null,curTax='a_la',curAZ='';
const PER=48;

const SEC_FR={
  'Elementary Methods':'Méthodes Élémentaires','Soups':'Potages','Sauces':'Sauces',
  'Garnishings':'Garnitures','Cold Side Dishes':"Hors-d'Œuvre Froids",
  'Hot Side Dishes':"Hors-d'Œuvre Chauds",'Mollusks and Crustaceans':'Mollusques et Crustacés',
  'Fish':'Poissons','Beef':'Bœuf','Veal':'Veau','Mutton':'Mouton','Lamb':'Agneau',
  'Pork':'Porc','Poultry':'Volaille','Game':'Gibier',
  'Miscellaneous Entrees':'Entrées Diverses','Cold Service':'Service Froid',
  'Vegetables':'Légumes','Eggs':'Œufs','Farinaceous':'Farineux',
  'Hot Sweet Entremets':'Entremets Chauds','Cold Sweet Entremets':'Entremets Froids',
  'Pastry':'Pâtisserie','Bakery':'Boulangerie','Ices':'Glaces',
  'Confectionery':'Confiserie','Wines':'Vins','Side Dishes':"Hors-d'Œuvre"
};
const TAX_DESC={
  a_la:'Preparations named for patrons, places, and classical garnishes — the great catalog of French culinary dedication.',
  au_aux:'Dishes defined by their primary ingredient or characteristic element.',
  en_method:'Dishes described by their vessel, form, or method of presentation.'
};

async function boot(){
  const bar=document.getElementById('lb'),sub=document.getElementById('ls-sub');
  try{
    let p=0;
    const t=setInterval(()=>{p=Math.min(p+Math.random()*9,88);bar.style.width=p+'%'},180);
    const resp=await fetch('epicurean_index.json');
    clearInterval(t);
    if(!resp.ok)throw new Error('HTTP '+resp.status);
    sub.textContent='Indexing…';bar.style.width='94%';
    DB=await resp.json();
    bar.style.width='100%';
    sub.textContent=DB.recipes.length.toLocaleString()+' recipes';
    document.getElementById('stat-r').textContent=DB.recipes.length.toLocaleString();
    await new Promise(r=>setTimeout(r,480));
    document.getElementById('ls').classList.add('hidden');
    buildGrid();buildAZ();buildTax();initSearch();
    loadTexts();
  }catch(e){
    document.getElementById('ls-sub').textContent='Could not load archive. Check all files are uploaded.';
    console.error(e);
  }
}

async function loadTexts(){
  try{
    const rs=await Promise.all([1,2,3,4,5,6].map(n=>fetch('epicurean_texts_'+n+'.json').then(r=>r.ok?r.json():{})));
    rs.forEach(c=>Object.assign(TEXTS,c));
  }catch(e){console.warn(e)}
}

function getText(id){
  const t=TEXTS[String(id)];
  if(t)return t;
  if(Object.keys(TEXTS).length===0)return 'Recipe text is still loading — please try again momentarily.';
  return 'Full text not available for this recipe.';
}

function setMode(m){
  mode=m;
  ['browse','search','az','tax'].forEach(k=>{
    document.getElementById('tab-'+k)?.classList.toggle('active',k===m);
  });
  document.getElementById('browse-panel').style.display=m==='browse'?'':'none';
  document.getElementById('az-panel').classList.toggle('vis',m==='az');
  document.getElementById('tax-panel').classList.toggle('vis',m==='tax');
  document.getElementById('srch-wrap').classList.toggle('vis',m==='search');
  document.getElementById('res-panel').style.display=m==='search'?'':'none';
  if(m==='search'){setTimeout(()=>document.getElementById('srch').focus(),50);if(!document.getElementById('srch').value)document.getElementById('res-inner').innerHTML='';}
}

function esc(s){return(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}
function hl(s,q){if(!q)return esc(s);const e=esc(s),eq=q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');return e.replace(new RegExp('('+eq+')','gi'),'<mark>$1</mark>')}

function buildGrid(){
  const cnt={};DB.recipes.forEach(r=>{cnt[r.section]=(cnt[r.section]||0)+1});
  const order=['Elementary Methods','Soups','Sauces','Garnishings','Cold Side Dishes','Hot Side Dishes',
    'Mollusks and Crustaceans','Fish','Beef','Veal','Mutton','Lamb','Pork','Poultry','Game',
    'Miscellaneous Entrees','Cold Service','Vegetables','Eggs','Farinaceous',
    'Hot Sweet Entremets','Cold Sweet Entremets','Pastry','Bakery','Ices','Confectionery','Wines','Side Dishes'];
  const secs=[...new Set(DB.recipes.map(r=>r.section))];
  const sorted=order.filter(s=>secs.includes(s)).concat(secs.filter(s=>!order.includes(s)));
  document.getElementById('sgrid').innerHTML=sorted.map(s=>`
    <button class="scard" onclick="showSec('${esc(s)}')">
      <span class="sn">${esc(s)}</span>
      <span class="sfr">${esc(SEC_FR[s]||s)}</span>
      <span class="sc">${cnt[s]||0}</span>
    </button>`).join('');
}

function showSec(s){
  curRes=DB.recipes.filter(r=>r.section===s);curPg=1;
  renderIn('res-inner','<span class="rl">'+esc(s)+'</span>',curRes.length,'');
  setMode('search');
  document.getElementById('srch').value='';
  document.getElementById('srch-ct').textContent='';
  document.getElementById('frb').classList.remove('vis');
  window.scrollTo({top:document.getElementById('nav').offsetTop,behavior:'smooth'});
}

function initSearch(){
  document.getElementById('srch').addEventListener('input',e=>{
    clearTimeout(sTmr);sTmr=setTimeout(()=>doSearch(e.target.value),220);
  });
}

function doSearch(raw){
  const q=raw.trim(),ql=q.toLowerCase();
  const ct=document.getElementById('srch-ct'),bd=document.getElementById('frb');
  if(!q){document.getElementById('res-inner').innerHTML='';ct.textContent='';bd.classList.remove('vis');return}
  if(/^\d+$/.test(q)){const r=DB.recipes.find(x=>x.id===parseInt(q));curRes=r?[r]:[]}
  else{
    let fr=false;
    curRes=DB.recipes.filter(r=>{
      const en=(r.english_title||'').toLowerCase().includes(ql);
      const fr2=(r.french_title||'').toLowerCase().includes(ql);
      const tx=TEXTS[String(r.id)]?(TEXTS[String(r.id)]).toLowerCase().includes(ql):false;
      if(fr2&&!en)fr=true;return en||fr2||tx;
    });
    bd.classList.toggle('vis',fr);
  }
  curPg=1;
  ct.textContent=curRes.length+' result'+(curRes.length!==1?'s':'');
  renderIn('res-inner','Results',curRes.length,q);
}

function buildAZ(){
  const byL={};
  DB.recipes.forEach(r=>{
    const fr=(r.french_title||r.english_title||'').trim();if(!fr)return;
    const M={'À':'A','Â':'A','Ä':'A','È':'E','É':'E','Ê':'E','Î':'I','Ô':'O','Û':'U','Ù':'U','Œ':'O','Ç':'C'};
    let ch=fr[0].toUpperCase();ch=M[ch]||ch;
    if(/[A-Z]/.test(ch)){if(!byL[ch])byL[ch]=[];byL[ch].push(r);}
  });
  window._AZ=byL;
  const strip=document.getElementById('az-strip');
  strip.innerHTML='ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').map(c=>`
    <button class="azb ${byL[c]?'':'empty'}" id="az-${c}" onclick="${byL[c]?`showAZ('${c}')`:''}">${c}</button>`).join('');
  const first='ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').find(c=>byL[c]);
  if(first)showAZ(first);
}

function showAZ(ch){
  curAZ=ch;
  document.querySelectorAll('.azb').forEach(b=>b.classList.remove('act'));
  document.getElementById('az-'+ch)?.classList.add('act');
  const recs=(window._AZ[ch]||[]).slice().sort((a,b)=>(a.french_title||'').localeCompare(b.french_title||'','fr'));
  curRes=recs;curPg=1;
  renderInEl(document.getElementById('az-res'),'<span class="rl">'+ch+'</span>',recs.length,'');
}

function buildTax(){
  const T={a_la:{},au_aux:{},en_method:{}};
  DB.recipes.forEach(r=>{
    const en=(r.english_title||'').toUpperCase();
    const fr=(r.french_title||'');
    const mA=en.match(/\bA\s+L[A'E]\s*([A-ZÀÁÂÃÄÇÈÉÊËÌÍÎÏÑÒÓÔÕÖÙÚÛÜÝ][A-ZÀÁÂÃÄÇÈÉÊËÌÍÎÏÑÒÓÔÕÖÙÚÛÜÝ\s'\-]{1,28}?)(?:\s*[-,(]|$)/);
    if(mA){const mod=mA[1].trim().replace(/[-,\s]+$/,'');const n=mod[0]+mod.slice(1).toLowerCase();if(n.length>1&&n.length<34){if(!T.a_la[n])T.a_la[n]=[];T.a_la[n].push(r)}}
    const mU=fr.match(/\bau[x]?\s+([A-Za-zÀ-ÿ][A-Za-zÀ-ÿ\s\-']{1,24}?)(?:\s*[,(\n]|$)/i);
    if(mU&&!/\ba\s+l[ae']/i.test(fr)){const mod=mU[1].trim().replace(/[-,\s]+$/,'');const n=mod[0].toUpperCase()+mod.slice(1);if(n.length>1&&n.length<28){if(!T.au_aux[n])T.au_aux[n]=[];T.au_aux[n].push(r)}}
    const mE=fr.match(/\ben\s+([A-Za-zÀ-ÿ][A-Za-zÀ-ÿ\s\-']{1,24}?)(?:\s*[,(\n]|$)/i);
    if(mE&&!/\ba\s+l[ae']/i.test(fr)){const mod=mE[1].trim().replace(/[-,\s]+$/,'');const n=mod[0].toUpperCase()+mod.slice(1);if(n.length>1&&n.length<28){if(!T.en_method[n])T.en_method[n]=[];T.en_method[n].push(r)}}
  });
  window._TAX=T;
  setTaxTab('a_la');
}

function setTaxTab(k){
  curTax=k;
  document.querySelectorAll('.ttab').forEach(t=>t.classList.remove('act'));
  document.getElementById('tt-'+k)?.classList.add('act');
  document.getElementById('tdesc').textContent=TAX_DESC[k]||'';
  const data=window._TAX[k]||{};
  const sorted=Object.entries(data).filter(([,a])=>a.length>=1).sort((a,b)=>b[1].length-a[1].length);
  const max=sorted[0]?.[1].length||1;
  document.getElementById('mcloud').innerHTML=sorted.map(([m,a])=>{
    const r=a.length/max,cl=r>.5?'fh':r>.2?'fm':'fl';
    return`<button class="mchip ${cl}" onclick="showMod('${esc(m)}','${k}',this)">${esc(m)} <small style="opacity:.45;font-size:.72em">${a.length}</small></button>`;
  }).join('');
  document.getElementById('tax-res').innerHTML='';
}

function showMod(mod,key,el){
  document.querySelectorAll('.mchip').forEach(c=>c.classList.remove('act'));
  el.classList.add('act');
  const recs=(window._TAX[key][mod]||[]);
  curRes=recs;curPg=1;
  renderInEl(document.getElementById('tax-res'),'<span style="font-style:italic;font-family:var(--fi)">'+esc(mod)+'</span>',recs.length,'',true);
  document.getElementById('tax-res').scrollIntoView({behavior:'smooth',block:'nearest'});
}

function renderIn(cid,label,count,q){
  renderInEl(document.getElementById(cid),label,count,q,false);
}

function renderInEl(el,label,count,q,compact){
  if(!el)return;
  const tot=Math.ceil(count/PER);
  const page=curRes.slice((curPg-1)*PER,curPg*PER);
  el.innerHTML=`
    <div class="rh"><span class="rl">${label}</span><span class="rc">${count.toLocaleString()} recipe${count!==1?'s':''}</span></div>
    ${renderList(page,q,compact)}
    ${tot>1?renderPages(curPg,tot,el.id,label,count,q):''}
  `;
  el.querySelectorAll('.rcard').forEach(c=>c.addEventListener('click',()=>openM(parseInt(c.dataset.id))));
}

function renderList(recs,q,compact){
  if(!recs.length)return'<p style="padding:2rem;color:var(--ivory-dim);font-style:italic;text-align:center">No recipes found.</p>';
  return`<div class="rlist">${recs.map(r=>`
    <button class="rcard" data-id="${r.id}">
      <span class="rno">No. ${r.id}</span>
      <span class="rfr">${q?hl(r.french_title||r.english_title,q):esc(r.french_title||r.english_title)}</span>
      <span class="ren">${q?hl(r.english_title,q):esc(r.english_title)}</span>
      ${compact?'':'<span class="rtag">'+esc(r.section)+'</span>'}
    </button>`).join('')}</div>`;
}

function renderPages(pg,tot,eid,lbl,cnt,q){
  const ps=[];
  for(let i=1;i<=tot;i++){
    if(i===1||i===tot||(i>=pg-2&&i<=pg+2))ps.push(i);
    else if(ps[ps.length-1]!=='…')ps.push('…');
  }
  return`<div class="pages">
    <button class="pb" ${pg===1?'disabled':''} onclick="goPg(${pg-1},'${eid}','${lbl}',${cnt},'${q}')">←</button>
    ${ps.map(p=>p==='…'?'<span class="pe">…</span>':`<button class="pb ${p===pg?'act':''}" onclick="goPg(${p},'${eid}','${lbl}',${cnt},'${q}')">${p}</button>`).join('')}
    <button class="pb" ${pg===tot?'disabled':''} onclick="goPg(${pg+1},'${eid}','${lbl}',${cnt},'${q}')">→</button>
  </div>`;
}

function goPg(p,eid,lbl,cnt,q){
  curPg=p;
  renderInEl(document.getElementById(eid),lbl,cnt,q);
  document.getElementById(eid)?.scrollIntoView({behavior:'smooth',block:'start'});
}

function openM(id){
  const r=DB.recipes.find(x=>x.id===id);if(!r)return;
  curMIdx=DB.recipes.indexOf(r);
  document.getElementById('m-no').textContent='No. '+r.id;
  document.getElementById('m-fr').textContent=r.french_title||r.english_title;
  document.getElementById('m-en').textContent=r.english_title;
  document.getElementById('m-sec').textContent=r.section;
  const tx=document.getElementById('m-txt');
  const t=TEXTS[String(r.id)];
  if(t){tx.textContent=t;tx.classList.remove('ld')}
  else{
    tx.textContent='Loading…';tx.classList.add('ld');
    const poll=setInterval(()=>{const t2=TEXTS[String(r.id)];if(t2){tx.textContent=t2;tx.classList.remove('ld');clearInterval(poll)}},400);
  }
  document.getElementById('m-prv').disabled=curMIdx===0;
  document.getElementById('m-nxt').disabled=curMIdx===DB.recipes.length-1;
  document.getElementById('mo').classList.add('open');
  document.body.style.overflow='hidden';
  document.getElementById('mdl').scrollTop=0;
}

function closeMO(e){if(e.target===document.getElementById('mo'))closeM()}
function closeM(){document.getElementById('mo').classList.remove('open');document.body.style.overflow=''}
function mNav(d){const n=curMIdx+d;if(n<0||n>=DB.recipes.length)return;openM(DB.recipes[n].id)}
document.addEventListener('keydown',e=>{
  if(e.key==='Escape')closeM();
  if(!document.getElementById('mo').classList.contains('open'))return;
  if(e.key==='ArrowLeft')mNav(-1);if(e.key==='ArrowRight')mNav(1);
});

boot();
</script>
</body>
</html>