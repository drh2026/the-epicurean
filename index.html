<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Epicurean — Charles Ranhofer · Delmonico's · 1894</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=IM+Fell+English:ital@0;1&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,500&family=Cinzel:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --midnight:#0a0d14;--navy:#111827;--navy-lt:#1a2436;--navy-btn:#1f2d45;
  --gold:#c9a84c;--gold-lt:#e8c97e;--gold-dim:#7a6030;
  --ivory:#f5efe0;--ivory-dim:#b8af9a;--claret:#6b1a2a;--claret-lt:#8b2a3a;
  --green:#2a5c3f;--green-lt:#3a7c55;
  --border:rgba(201,168,76,.2);--border-s:rgba(201,168,76,.48);
  --shadow:0 12px 60px rgba(0,0,0,.75);
  --fd:'Cinzel',serif;--ft:'Playfair Display',serif;
  --fb:'Cormorant Garamond',serif;--fi:'IM Fell English',serif;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{background:var(--midnight);color:var(--ivory);font-family:var(--fb);font-size:18px;line-height:1.6;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.035'/%3E%3C/svg%3E");pointer-events:none;z-index:999;opacity:.6}

/* LOADING */
#ls{position:fixed;inset:0;background:var(--midnight);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9000;transition:opacity .8s,visibility .8s}
#ls.hidden{opacity:0;visibility:hidden;pointer-events:none}
.lm{width:72px;height:72px;border:1px solid var(--gold-dim);border-top-color:var(--gold);border-radius:50%;animation:spin 1.8s linear infinite;margin-bottom:2rem;position:relative}
.lm::after{content:'✦';position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:var(--gold);font-size:1.3rem;animation:spin 1.8s linear infinite reverse}
@keyframes spin{to{transform:rotate(360deg)}}
.lt{font-family:var(--fd);font-size:clamp(.9rem,2.5vw,1.2rem);letter-spacing:.35em;color:var(--gold);text-transform:uppercase;margin-bottom:.4rem}
.ls-s{font-family:var(--fi);font-style:italic;color:var(--ivory-dim);font-size:.95rem}
.lbw{width:220px;height:1px;background:var(--border);margin-top:1.8rem}
.lb{height:100%;background:linear-gradient(90deg,var(--gold-dim),var(--gold));width:0;transition:width .3s}

/* HEADER */
#hdr{position:relative;text-align:center;padding:clamp(3rem,8vw,6rem) 2rem clamp(2rem,5vw,3.5rem);border-bottom:1px solid var(--border);overflow:hidden}
#hdr::before,#hdr::after{content:'';position:absolute;width:160px;height:160px;border:1px solid var(--border);opacity:.4}
#hdr::before{top:1rem;left:1rem;border-right:none;border-bottom:none}
#hdr::after{top:1rem;right:1rem;border-left:none;border-bottom:none}
.h-ey{font-family:var(--fd);font-size:clamp(.5rem,1.3vw,.65rem);letter-spacing:.45em;color:var(--gold-dim);text-transform:uppercase;margin-bottom:1.4rem}
.h-ti{font-family:var(--fd);font-size:clamp(2.2rem,8vw,5.5rem);font-weight:700;letter-spacing:.12em;color:var(--gold);text-transform:uppercase;line-height:1;text-shadow:0 0 80px rgba(201,168,76,.18)}
.h-rule{display:flex;align-items:center;justify-content:center;gap:1rem;margin:1.2rem auto;max-width:380px}
.h-rl{flex:1;height:1px;background:var(--border-s)}
.h-ro{color:var(--gold);font-size:.75rem;letter-spacing:.3em}
.h-sub{font-family:var(--fi);font-style:italic;font-size:clamp(.9rem,2.3vw,1.25rem);color:var(--ivory-dim);letter-spacing:.04em;margin-bottom:.3rem}
.h-by{font-family:var(--fd);font-size:clamp(.5rem,1.1vw,.6rem);letter-spacing:.4em;color:var(--gold-dim);text-transform:uppercase;margin-top:1.4rem}
.h-stats{display:flex;align-items:center;justify-content:center;gap:1.8rem;margin-top:1.8rem;flex-wrap:wrap}
.stat-n{font-family:var(--ft);font-size:1.5rem;font-weight:700;color:var(--gold);display:block;line-height:1}
.stat-l{font-family:var(--fd);font-size:.48rem;letter-spacing:.35em;color:var(--ivory-dim);text-transform:uppercase;margin-top:.25rem;display:block}
.stat-div{color:var(--border-s)}

/* NAV */
#nav{position:sticky;top:0;background:rgba(10,13,20,.97);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);z-index:200;padding:0 1rem}
.nav-i{max-width:1300px;margin:0 auto;display:flex;align-items:stretch;justify-content:center;flex-wrap:wrap}
.ntab{font-family:var(--fd);font-size:clamp(.45rem,1.05vw,.57rem);letter-spacing:.25em;text-transform:uppercase;color:var(--ivory-dim);background:none;border:none;border-bottom:2px solid transparent;padding:1rem clamp(.6rem,1.6vw,1.4rem);cursor:pointer;transition:color .2s,border-color .2s;white-space:nowrap}
.ntab:hover{color:var(--ivory)}
.ntab.active{color:var(--gold);border-bottom-color:var(--gold)}
.ntab.ntab-special{color:var(--claret-lt)}
.ntab.ntab-special:hover{color:var(--ivory)}
.ntab.ntab-special.active{color:var(--gold-lt);border-bottom-color:var(--gold-lt)}

/* SEARCH */
#srch-wrap{display:none;max-width:700px;margin:0 auto;padding:2.5rem 1.5rem 1.5rem}
#srch-wrap.vis{display:block}
.sf-wrap{position:relative}
.si{position:absolute;left:1.1rem;top:50%;transform:translateY(-50%);color:var(--gold-dim);font-size:1rem;pointer-events:none}
#srch{width:100%;background:var(--navy-lt);border:1px solid var(--border);border-radius:2px;color:var(--ivory);font-family:var(--fb);font-size:1rem;padding:.8rem 1rem .8rem 2.7rem;outline:none;transition:border-color .2s;letter-spacing:.02em}
#srch:focus{border-color:var(--border-s)}
#srch::placeholder{color:var(--ivory-dim);opacity:.45}
#srch-ct{font-family:var(--fd);font-size:.52rem;letter-spacing:.3em;color:var(--ivory-dim);text-transform:uppercase;margin-top:.7rem;text-align:right;min-height:1.2em}
.frb{display:none;align-items:center;gap:.5rem;font-family:var(--fi);font-style:italic;font-size:.8rem;color:var(--gold-dim);margin-top:.4rem}
.frb.vis{display:flex}
.frd{width:6px;height:6px;background:var(--gold);border-radius:50%;animation:pd 1.5s ease infinite}
@keyframes pd{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.3;transform:scale(.55)}}

/* MAIN */
#main{max-width:1300px;margin:0 auto;padding:0 clamp(1rem,3vw,2.5rem)}

/* BROWSE */
#browse-panel{padding:3rem 0}
.br-intro{text-align:center;padding:0 0 2.5rem}
.br-intro p{font-family:var(--fi);font-style:italic;color:var(--ivory-dim);font-size:1rem;max-width:520px;margin:0 auto;line-height:1.75}
.sgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:1px;border:1px solid var(--border)}
.scard{background:var(--navy);padding:1.7rem 1.4rem;cursor:pointer;transition:background .18s;border:none;text-align:left;position:relative;overflow:hidden}
.scard::before{content:'';position:absolute;top:0;left:0;width:2px;height:0;background:var(--gold);transition:height .22s}
.scard:hover{background:var(--navy-lt)}
.scard:hover::before{height:100%}
.sn{font-family:var(--fd);font-size:clamp(.5rem,1.1vw,.6rem);letter-spacing:.28em;color:var(--gold);text-transform:uppercase;display:block;margin-bottom:.5rem}
.sfr{font-family:var(--fi);font-style:italic;color:var(--ivory-dim);font-size:.88rem;display:block;margin-bottom:.7rem;line-height:1.3}
.sc{font-family:var(--ft);font-size:1.7rem;font-weight:700;color:var(--ivory);opacity:.12;display:block;line-height:1;transition:opacity .18s}
.scard:hover .sc{opacity:.3}

/* AZ */
#az-panel{display:none;padding:2.5rem 0}
#az-panel.vis{display:block}
.az-strip{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:2.5rem;border-bottom:1px solid var(--border);padding-bottom:1.5rem}
.azb{font-family:var(--fd);font-size:.6rem;letter-spacing:.18em;width:36px;height:36px;border:1px solid var(--border);background:none;color:var(--ivory-dim);cursor:pointer;transition:all .15s;text-transform:uppercase}
.azb:hover:not(.empty){border-color:var(--gold);color:var(--gold)}
.azb.act{background:var(--gold);color:var(--midnight);border-color:var(--gold)}
.azb.empty{opacity:.2;cursor:default}

/* TAXONOMY */
#tax-panel{display:none;padding:2.5rem 0}
#tax-panel.vis{display:block}
.ttabs{display:flex;gap:1px;border-bottom:1px solid var(--border);margin-bottom:1.8rem}
.ttab{font-family:var(--fi);font-style:italic;font-size:1.05rem;color:var(--ivory-dim);background:none;border:none;border-bottom:2px solid transparent;padding:.6rem 1.4rem;cursor:pointer;transition:color .2s;margin-bottom:-1px}
.ttab:hover{color:var(--ivory)}
.ttab.act{color:var(--gold);border-bottom-color:var(--gold)}
.tdesc{font-family:var(--fi);font-style:italic;font-size:.86rem;color:var(--ivory-dim);margin-bottom:1.4rem;line-height:1.65;max-width:540px}
.mcloud{display:flex;flex-wrap:wrap;gap:7px;margin-bottom:2rem}
.mchip{font-family:var(--fi);font-style:italic;background:none;border:1px solid var(--border);color:var(--ivory-dim);padding:.3rem .8rem;cursor:pointer;border-radius:1px;transition:all .15s;line-height:1.3}
.mchip:hover{border-color:var(--gold);color:var(--gold)}
.mchip.act{background:rgba(201,168,76,.1);border-color:var(--gold);color:var(--gold)}
.fh{font-size:1.05rem}.fm{font-size:.9rem}.fl{font-size:.76rem}

/* MENU PLANNER */
#menu-panel{display:none;padding:2.5rem 0}
#menu-panel.vis{display:block}
.menu-intro{max-width:640px;margin:0 auto 2.5rem;text-align:center}
.menu-intro h2{font-family:var(--fd);font-size:clamp(.7rem,2vw,.9rem);letter-spacing:.3em;color:var(--gold);text-transform:uppercase;margin-bottom:.8rem}
.menu-intro p{font-family:var(--fi);font-style:italic;color:var(--ivory-dim);font-size:.95rem;line-height:1.7}
.menu-controls{display:flex;flex-wrap:wrap;gap:.8rem;justify-content:center;margin-bottom:2rem}
.menu-course-toggle{font-family:var(--fd);font-size:.5rem;letter-spacing:.25em;text-transform:uppercase;background:var(--navy-lt);border:1px solid var(--border);color:var(--ivory-dim);padding:.5rem .9rem;cursor:pointer;transition:all .15s;border-radius:1px}
.menu-course-toggle.on{border-color:var(--gold);color:var(--gold);background:rgba(201,168,76,.08)}
.menu-btn-row{display:flex;gap:1rem;justify-content:center;margin-bottom:2.5rem;flex-wrap:wrap}
.menu-btn{font-family:var(--fd);font-size:.55rem;letter-spacing:.3em;text-transform:uppercase;padding:.7rem 2rem;cursor:pointer;border:1px solid;transition:all .18s;border-radius:1px}
.btn-gen{background:var(--gold);color:var(--midnight);border-color:var(--gold)}
.btn-gen:hover{background:var(--gold-lt);border-color:var(--gold-lt)}
.btn-regen{background:none;color:var(--ivory-dim);border-color:var(--border)}
.btn-regen:hover{border-color:var(--gold);color:var(--gold)}
.btn-print-menu{background:none;color:var(--ivory-dim);border-color:var(--border)}
.btn-print-menu:hover{border-color:var(--claret-lt);color:var(--claret-lt)}
.menu-result{max-width:720px;margin:0 auto;border:1px solid var(--border)}
.menu-card-header{background:var(--navy-lt);padding:1.5rem 2rem;border-bottom:1px solid var(--border);text-align:center}
.menu-card-title{font-family:var(--fd);font-size:clamp(.6rem,1.5vw,.75rem);letter-spacing:.35em;color:var(--gold);text-transform:uppercase;display:block;margin-bottom:.3rem}
.menu-card-sub{font-family:var(--fi);font-style:italic;color:var(--ivory-dim);font-size:.85rem}
.menu-course-item{display:flex;align-items:stretch;border-bottom:1px solid var(--border)}
.menu-course-item:last-child{border-bottom:none}
.mci-label{font-family:var(--fd);font-size:.45rem;letter-spacing:.3em;text-transform:uppercase;color:var(--gold-dim);writing-mode:vertical-rl;transform:rotate(180deg);padding:.8rem .5rem;border-right:1px solid var(--border);display:flex;align-items:center;min-width:32px;background:rgba(201,168,76,.04)}
.mci-content{flex:1;padding:1rem 1.5rem;cursor:pointer;transition:background .15s}
.mci-content:hover{background:rgba(201,168,76,.04)}
.mci-fr{font-family:var(--fi);font-style:italic;font-size:1.05rem;color:var(--ivory);display:block;line-height:1.3}
.mci-en{font-family:var(--fb);font-size:.82rem;color:var(--ivory-dim);display:block;margin-top:.15rem}
.mci-no{font-family:var(--fd);font-size:.42rem;letter-spacing:.25em;color:var(--gold-dim);text-transform:uppercase;margin-top:.4rem;display:block}
.mci-actions{display:flex;align-items:center;gap:.5rem;padding:.8rem 1rem;border-left:1px solid var(--border)}
.mci-swap{font-family:var(--fd);font-size:.45rem;letter-spacing:.2em;text-transform:uppercase;background:none;border:1px solid var(--border);color:var(--ivory-dim);padding:.4rem .6rem;cursor:pointer;transition:all .14s;white-space:nowrap}
.mci-swap:hover{border-color:var(--gold);color:var(--gold)}
.menu-empty{text-align:center;padding:3rem;font-family:var(--fi);font-style:italic;color:var(--ivory-dim)}

/* BOOK READER */
#book-panel{display:none;padding:2rem 0}
#book-panel.vis{display:block}
.book-header{text-align:center;margin-bottom:1.5rem}
.book-header h2{font-family:var(--fd);font-size:clamp(.65rem,1.8vw,.85rem);letter-spacing:.35em;color:var(--gold);text-transform:uppercase;margin-bottom:.5rem}
.book-header p{font-family:var(--fi);font-style:italic;color:var(--ivory-dim);font-size:.9rem;line-height:1.7;max-width:540px;margin:0 auto .8rem}
.book-link-bar{display:flex;justify-content:center;gap:1rem;flex-wrap:wrap;margin-bottom:1.5rem}
.book-link{font-family:var(--fd);font-size:.52rem;letter-spacing:.25em;text-transform:uppercase;color:var(--gold);border:1px solid var(--border-s);padding:.5rem 1.2rem;text-decoration:none;transition:all .15s;cursor:pointer;background:none}
.book-link:hover{background:rgba(201,168,76,.08);border-color:var(--gold)}
.book-frame-wrap{position:relative;width:100%;padding-bottom:72%;background:var(--navy);border:1px solid var(--border)}
.book-frame-wrap iframe{position:absolute;inset:0;width:100%;height:100%;border:none}
.book-frame-wrap .book-loading{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:var(--ivory-dim);font-family:var(--fi);font-style:italic}

/* RESULTS */
.rh{display:flex;align-items:baseline;justify-content:space-between;flex-wrap:wrap;gap:.5rem;padding:1.5rem 0 1rem;border-bottom:1px solid var(--border);margin-bottom:1.5rem}
.rl{font-family:var(--fd);font-size:.52rem;letter-spacing:.35em;color:var(--gold);text-transform:uppercase}
.rc{font-family:var(--fi);font-style:italic;color:var(--ivory-dim);font-size:.86rem}
.rlist{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1px;background:var(--border)}
.rcard{background:var(--navy);padding:1.3rem 1.4rem;cursor:pointer;border:none;text-align:left;transition:background .14s;position:relative}
.rcard:hover{background:var(--navy-lt)}
.rcard:hover .rno{color:var(--gold)}
.rno{font-family:var(--fd);font-size:.5rem;letter-spacing:.28em;color:var(--gold-dim);text-transform:uppercase;display:block;margin-bottom:.35rem;transition:color .14s}
.rfr{font-family:var(--fi);font-style:italic;font-size:.98rem;color:var(--ivory);display:block;line-height:1.35;margin-bottom:.2rem}
.ren{font-family:var(--fb);font-size:.8rem;color:var(--ivory-dim);display:block;line-height:1.3}
.rtag{display:inline-block;margin-top:.6rem;font-family:var(--fd);font-size:.42rem;letter-spacing:.28em;text-transform:uppercase;color:var(--gold-dim);border:1px solid var(--border);padding:.12rem .45rem}

/* PAGINATION */
.pages{display:flex;align-items:center;justify-content:center;gap:.4rem;padding:2rem 0 1rem;flex-wrap:wrap}
.pb{font-family:var(--fd);font-size:.52rem;letter-spacing:.18em;min-width:34px;height:34px;border:1px solid var(--border);background:none;color:var(--ivory-dim);cursor:pointer;transition:all .14s;text-transform:uppercase;padding:0 .5rem}
.pb:hover:not(:disabled){border-color:var(--gold);color:var(--gold)}
.pb.act{background:var(--gold);color:var(--midnight);border-color:var(--gold)}
.pb:disabled{opacity:.25;cursor:default}
.pe{color:var(--ivory-dim);font-size:.8rem}

/* MODAL */
#mo{position:fixed;inset:0;background:rgba(10,13,20,.92);backdrop-filter:blur(6px);z-index:500;display:none;align-items:center;justify-content:center;padding:1.5rem}
#mo.open{display:flex}
#mdl{background:var(--navy);border:1px solid var(--border-s);max-width:820px;width:100%;max-height:90vh;overflow-y:auto;position:relative;box-shadow:var(--shadow);animation:mi .22s ease}
@keyframes mi{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:none}}
.mhdr{padding:1.8rem 1.8rem 1.2rem;border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--navy);z-index:10}
.m-no-badge{display:flex;align-items:center;gap:.8rem;margin-bottom:.7rem}
.mno{font-family:var(--fd);font-size:.52rem;letter-spacing:.35em;color:var(--gold-dim);text-transform:uppercase;display:inline-block;border:1px solid var(--border);padding:.2rem .6rem}
.m-ia-link{font-family:var(--fd);font-size:.45rem;letter-spacing:.25em;text-transform:uppercase;color:var(--claret-lt);text-decoration:none;border:1px solid rgba(107,26,42,.5);padding:.2rem .6rem;transition:all .14s;cursor:pointer;background:none}
.m-ia-link:hover{border-color:var(--claret-lt);background:rgba(107,26,42,.15);color:var(--ivory)}
.mfr{font-family:var(--ft);font-size:clamp(1.1rem,3vw,1.65rem);font-style:italic;color:var(--ivory);display:block;line-height:1.3;margin-bottom:.3rem}
.men{font-family:var(--fb);font-size:.9rem;color:var(--ivory-dim);display:block}
.msec{display:inline-block;margin-top:.7rem;font-family:var(--fd);font-size:.45rem;letter-spacing:.28em;text-transform:uppercase;color:var(--gold-dim);border:1px solid var(--border);padding:.18rem .55rem}
.mbody{padding:0}
/* Tab switcher inside modal */
.m-tabs{display:flex;border-bottom:1px solid var(--border);background:rgba(10,13,20,.4)}
.m-tab{font-family:var(--fd);font-size:.48rem;letter-spacing:.25em;text-transform:uppercase;color:var(--ivory-dim);background:none;border:none;border-bottom:2px solid transparent;padding:.7rem 1.2rem;cursor:pointer;transition:all .15s;margin-bottom:-1px}
.m-tab:hover{color:var(--ivory)}
.m-tab.act{color:var(--gold);border-bottom-color:var(--gold)}
.m-pane{display:none;padding:1.6rem 1.8rem}
.m-pane.vis{display:block}
/* Ingredients pane */
.ingr-note{font-family:var(--fi);font-style:italic;font-size:.82rem;color:var(--ivory-dim);margin-bottom:1.2rem;line-height:1.6;border-left:2px solid var(--gold-dim);padding-left:.8rem}
.ingr-list{list-style:none;padding:0}
.ingr-list li{padding:.4rem 0;border-bottom:1px solid var(--border);font-family:var(--fb);font-size:.95rem;color:var(--ivory);display:flex;align-items:baseline;gap:.7rem}
.ingr-list li::before{content:'—';color:var(--gold-dim);font-size:.75rem;flex-shrink:0}
.ingr-none{font-family:var(--fi);font-style:italic;color:var(--ivory-dim);font-size:.9rem}
/* Method pane */
.mtxt{font-family:var(--fb);font-size:1.02rem;line-height:1.78;color:var(--ivory-dim);white-space:pre-wrap}
.mtxt.ld{font-style:italic;opacity:.45;text-align:center;padding:1rem 0}
.mtxt a.xref{color:var(--gold-dim);text-decoration:none;border-bottom:1px dotted var(--gold-dim);cursor:pointer}
.mtxt a.xref:hover{color:var(--gold)}
/* Source pane */
.source-info{padding:.5rem 0}
.source-row{display:flex;align-items:baseline;gap:.8rem;padding:.7rem 0;border-bottom:1px solid var(--border)}
.source-row:last-child{border-bottom:none}
.src-label{font-family:var(--fd);font-size:.45rem;letter-spacing:.28em;text-transform:uppercase;color:var(--gold-dim);min-width:100px;flex-shrink:0}
.src-val{font-family:var(--fb);font-size:.95rem;color:var(--ivory)}
.src-link{font-family:var(--fd);font-size:.48rem;letter-spacing:.2em;text-transform:uppercase;color:var(--claret-lt);text-decoration:none;border:1px solid rgba(107,26,42,.5);padding:.3rem .8rem;transition:all .14s;cursor:pointer;background:none;display:inline-block;margin-top:.3rem}
.src-link:hover{background:rgba(107,26,42,.2);border-color:var(--claret-lt);color:var(--ivory)}
.src-note{font-family:var(--fi);font-style:italic;font-size:.8rem;color:var(--ivory-dim);margin-top:.8rem;line-height:1.6;border-left:2px solid var(--border);padding-left:.7rem}
/* Modal actions */
.m-actions{display:flex;align-items:center;justify-content:flex-end;gap:.5rem;padding:.8rem 1.8rem;border-top:1px solid var(--border);background:rgba(10,13,20,.3)}
.m-act-btn{font-family:var(--fd);font-size:.45rem;letter-spacing:.22em;text-transform:uppercase;background:none;border:1px solid var(--border);color:var(--ivory-dim);padding:.4rem .8rem;cursor:pointer;transition:all .14s}
.m-act-btn:hover{border-color:var(--gold);color:var(--gold)}
.m-act-btn.print-btn:hover{border-color:var(--claret-lt);color:var(--claret-lt)}
.mcls{position:absolute;top:1rem;right:1rem;width:30px;height:30px;background:none;border:1px solid var(--border);color:var(--ivory-dim);font-size:.95rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s;font-family:sans-serif}
.mcls:hover{border-color:var(--gold);color:var(--gold)}
.mnav{display:flex;justify-content:space-between;padding:.9rem 1.8rem 1.3rem;border-top:1px solid var(--border);gap:.8rem}
.mnb{font-family:var(--fd);font-size:.48rem;letter-spacing:.22em;text-transform:uppercase;color:var(--ivory-dim);background:none;border:1px solid var(--border);padding:.45rem .9rem;cursor:pointer;transition:all .14s;flex:1;text-align:center}
.mnb:hover:not(:disabled){border-color:var(--gold);color:var(--gold)}
.mnb:disabled{opacity:.22;cursor:default}

/* FOOTER */
#ftr{border-top:1px solid var(--border);padding:2.5rem 2rem;text-align:center;margin-top:2rem}
.fo{color:var(--gold-dim);letter-spacing:.5em;font-size:.65rem;margin-bottom:.9rem}
.ft{font-family:var(--fi);font-style:italic;color:var(--ivory-dim);font-size:.82rem;line-height:1.8;max-width:460px;margin:0 auto}

/* UTIL */
.hidden{display:none!important}
mark{background:rgba(201,168,76,.22);color:var(--gold);padding:0 2px;border-radius:1px}
::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-track{background:var(--midnight)}
::-webkit-scrollbar-thumb{background:var(--gold-dim);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--gold)}

/* PRINT STYLES */
@media print{
  body{background:#fff;color:#000;font-size:11pt}
  #ls,#nav,#hdr .h-stats,#ftr,#mo,.mcls,.mnav,.m-actions,
  #srch-wrap,.az-strip,.ttabs,.mcloud,.menu-controls,.menu-btn-row,
  .scard,.rcard,.pages,.ntab,#book-panel,
  .ntab-special{display:none!important}
  #hdr{padding:1rem;border:none}
  .h-ti{font-size:2rem;color:#000;text-shadow:none}
  .h-sub,.h-by,.h-ey,.h-rule{color:#444}
  #main{padding:0}
  .print-only{display:block!important}
  /* Print modal recipe */
  #mo{position:static;display:block;background:none;backdrop-filter:none;padding:0}
  #mdl{max-width:100%;box-shadow:none;border:none;max-height:none;overflow:visible}
  .mhdr{position:static;border-bottom:2px solid #000;padding:1rem 0}
  .mfr{color:#000;font-size:1.4rem}
  .men{color:#444}
  .mno,.msec{border:1px solid #888;color:#444}
  .m-ia-link{display:none}
  .m-tabs{display:none}
  .m-pane{display:block!important;padding:.5rem 0}
  .m-pane#pane-method{page-break-before:avoid}
  .mtxt{color:#000;font-size:10.5pt;line-height:1.6}
  .ingr-list li{border-bottom:1px solid #ddd;color:#000}
  .ingr-list li::before{color:#888}
  .ingr-note{color:#666;border-left:2px solid #888}
  .source-info{display:none}
  /* Print menu */
  .menu-result{border:2px solid #000;max-width:100%}
  .menu-card-header{background:#000;color:#fff;-webkit-print-color-adjust:exact;print-color-adjust:exact}
  .menu-card-title{color:#fff}
  .menu-card-sub{color:#ddd}
  .mci-label{background:#f0f0f0;color:#000;-webkit-print-color-adjust:exact}
  .mci-fr{color:#000}
  .mci-en{color:#444}
  .mci-no{color:#888}
  .mci-actions{display:none}
  .menu-course-item{border-bottom:1px solid #ddd}
}

@media(max-width:640px){
  .sgrid,.rlist{grid-template-columns:1fr 1fr}
  #mdl{max-height:95vh}
  .mhdr,.m-pane,.mnav,.m-actions{padding-left:1.1rem;padding-right:1.1rem}
  .ntab{padding:.9rem .5rem}
  .h-stats{gap:1rem}
  .menu-result{margin:0 -.5rem}
}
</style>
</head>
<body>

<div id="ls">
  <div class="lm"></div>
  <div class="lt">The Epicurean</div>
  <div class="ls-s" id="ls-sub">Consulting the archive…</div>
  <div class="lbw"><div class="lb" id="lb"></div></div>
</div>

<header id="hdr">
  <div class="h-ey">Delmonico's · New York · Established 1827</div>
  <h1 class="h-ti">The Epicurean</h1>
  <div class="h-rule"><div class="h-rl"></div><div class="h-ro">✦ ✦ ✦</div><div class="h-rl"></div></div>
  <div class="h-sub">A Complete Treatise of Analytical and Practical Studies on the Culinary Art</div>
  <div class="h-by">Charles Ranhofer · Chef of Delmonico's · 1836–1899</div>
  <div class="h-stats">
    <div class="stat"><span class="stat-n" id="stat-r">—</span><span class="stat-l">Recipes</span></div>
    <span class="stat-div">·</span>
    <div class="stat"><span class="stat-n">23</span><span class="stat-l">Chapters</span></div>
    <span class="stat-div">·</span>
    <div class="stat"><span class="stat-n">1894</span><span class="stat-l">First Edition</span></div>
  </div>
</header>

<section id="about-author" style="
  max-width:820px; margin:0 auto;
  padding:clamp(2.5rem,6vw,4rem) clamp(1.5rem,4vw,3rem);
  border-bottom:1px solid var(--border);
  text-align:center;
">
  <div style="font-family:var(--fd);font-size:clamp(.5rem,1.2vw,.62rem);letter-spacing:.4em;color:var(--gold-dim);text-transform:uppercase;margin-bottom:1.4rem">
    Charles Ranhofer · 1836–1899
  </div>
  <div style="font-family:var(--fi);font-style:italic;font-size:clamp(.95rem,2.2vw,1.15rem);color:var(--ivory-dim);line-height:1.85;max-width:680px;margin:0 auto 1.2rem">
    Born in Saint-Denis, France in 1836, Charles Ranhofer came to America in 1860 and became head chef of Delmonico's restaurant in New York — the most celebrated dining establishment in the Western hemisphere — a position he would hold for thirty-four years. Under his hand, Delmonico's hosted presidents, emperors, and the gilded society of the Gilded Age itself. He cooked for Abraham Lincoln, Ulysses S. Grant, and the Prince of Wales; he invented Lobster Newberg and Baked Alaska; he elevated American fine dining to a standard equal to the great houses of Paris.
  </div>
  <div style="font-family:var(--fi);font-style:italic;font-size:clamp(.95rem,2.2vw,1.15rem);color:var(--ivory-dim);line-height:1.85;max-width:680px;margin:0 auto">
    <em>The Epicurean</em>, published in 1894 and running to nearly 1,200 pages, was his life's testament — a monument of culinary scholarship containing 3,184 recipes, menus for every occasion, instructions for carving and service, and the complete philosophy of the professional kitchen as Ranhofer understood it. No comparable work had been produced in America before it, and few have matched its ambition since. He died in New York in 1899, five years after its publication, leaving this book as the definitive record of what haute cuisine looked like at its American zenith.
  </div>
  <div style="margin-top:1.8rem;display:flex;align-items:center;justify-content:center;gap:1rem">
    <div style="flex:1;max-width:120px;height:1px;background:var(--border)"></div>
    <span style="color:var(--gold-dim);font-size:.75rem">✦</span>
    <div style="flex:1;max-width:120px;height:1px;background:var(--border)"></div>
  </div>
</section>

<nav id="nav">
  <div class="nav-i">
    <button class="ntab active" onclick="setMode('browse')" id="tab-browse">Browse Chapters</button>
    <button class="ntab" onclick="setMode('search')" id="tab-search">Search Archive</button>
    <button class="ntab" onclick="setMode('az')" id="tab-az">A–Z Index</button>
    <button class="ntab" onclick="setMode('tax')" id="tab-tax">À la · Au · En</button>
    <button class="ntab ntab-special" onclick="setMode('menu')" id="tab-menu">Menu Planner</button>
    <button class="ntab ntab-special" onclick="setMode('book')" id="tab-book">Original Book</button>
  </div>
</nav>

<main id="main">

  <div id="srch-wrap">
    <div class="sf-wrap">
      <span class="si">⌕</span>
      <input id="srch" type="search" placeholder="Search titles, French names, or recipe number…" autocomplete="off" spellcheck="false">
    </div>
    <div id="srch-ct"></div>
    <div class="frb" id="frb"><span class="frd"></span>Matched on French title</div>
  </div>

  <!-- Browse -->
  <div id="browse-panel">
    <div class="br-intro">
      <p>Twenty-three chapters spanning the full range of haute cuisine as practised at Delmonico's — from elementary methods to the grandest cold service.</p>
    </div>
    <div class="sgrid" id="sgrid"></div>
  </div>

  <!-- AZ -->
  <div id="az-panel">
    <div class="az-strip" id="az-strip"></div>
    <div id="az-res"></div>
  </div>

  <!-- Taxonomy -->
  <div id="tax-panel">
    <div class="ttabs">
      <button class="ttab act" onclick="setTaxTab('a_la')" id="tt-a_la">à la</button>
      <button class="ttab" onclick="setTaxTab('au_aux')" id="tt-au_aux">au / aux</button>
      <button class="ttab" onclick="setTaxTab('en_method')" id="tt-en_method">en</button>
    </div>
    <div class="tdesc" id="tdesc"></div>
    <div class="mcloud" id="mcloud"></div>
    <div id="tax-res"></div>
  </div>

  <!-- Menu Planner -->
  <div id="menu-panel">
    <div class="menu-intro">
      <h2>Menu Planner</h2>
      <p>Compose a Delmonico's dinner in the authentic Ranhofer style. Select your courses and generate a complete menu — regenerate at will until it pleases.</p>
    </div>
    <div style="max-width:420px;margin:0 auto 1.5rem;text-align:center">
      <input id="menu-name-input" type="text" placeholder="Name your menu…"
        style="width:100%;background:var(--navy-lt);border:1px solid var(--border);
               border-radius:2px;color:var(--ivory);font-family:var(--ft);
               font-size:1.1rem;font-style:italic;padding:.7rem 1rem;
               outline:none;text-align:center;letter-spacing:.03em;transition:border-color .2s"
        onfocus="this.style.borderColor='var(--border-s)'"
        onblur="this.style.borderColor='var(--border)'">
    </div>
    <div class="menu-controls" id="menu-toggles"></div>
    <div class="menu-btn-row">
      <button class="menu-btn btn-gen" onclick="generateMenu()">Generate Menu</button>
      <button class="menu-btn btn-regen" id="btn-regen" onclick="generateMenu()" style="display:none">↺ Regenerate</button>
      <button class="menu-btn btn-print-menu" id="btn-print-menu" onclick="printMenu()" style="display:none">⎙ Print Menu</button>
    </div>
    <div class="menu-result" id="menu-result"></div>
  </div>

  <!-- Book Reader -->
  <div id="book-panel">
    <div class="book-header">
      <h2>Original 1894 Edition</h2>
      <p>The complete digitized first edition of <em>The Epicurean</em>, courtesy of the Internet Archive. Public domain — copyright expired.</p>
    </div>
    <div class="book-link-bar">
      <a class="book-link" href="https://archive.org/details/epicureancomplet00ranh_0" target="_blank" rel="noopener">Open Full Screen ↗</a>
      <a class="book-link" href="https://archive.org/download/epicureancomplet00ranh_0/epicureancomplet00ranh_0.pdf" target="_blank" rel="noopener">Download PDF ↓</a>
      <button class="book-link" onclick="bookJump()">Jump to Recipe Page</button>
    </div>
    <div class="book-frame-wrap">
      <div class="book-loading">Loading the original edition…</div>
      <iframe id="book-frame"
        src="about:blank"
        allowfullscreen
        title="The Epicurean, 1894 — Internet Archive">
      </iframe>
    </div>
    <p style="font-family:var(--fi);font-style:italic;color:var(--ivory-dim);font-size:.8rem;text-align:center;margin-top:.8rem;line-height:1.6">
      Scanned from the original held at the Library of Congress. 
      If a recipe's spelling or ingredients appear uncertain, the source page is always authoritative.
    </p>
  </div>

  <!-- Search / Section results -->
  <div id="res-panel" style="display:none">
    <div id="res-inner"></div>
  </div>

</main>

<!-- Modal -->
<div id="mo" onclick="closeMO(event)">
  <div id="mdl" role="dialog">
    <button class="mcls" onclick="closeM()">✕</button>
    <div class="mhdr">
      <div class="m-no-badge">
        <span class="mno" id="m-no"></span>
        <a class="m-ia-link" id="m-ia" href="#" target="_blank" rel="noopener">View in Original Book ↗</a>
      </div>
      <span class="mfr" id="m-fr"></span>
      <span class="men" id="m-en"></span>
      <span class="msec" id="m-sec"></span>
    </div>
    <div class="mbody">
      <div class="m-tabs">
        <button class="m-tab act" onclick="mTab('ingredients',this)">Ingredients</button>
        <button class="m-tab" onclick="mTab('method',this)">Method</button>
        <button class="m-tab" onclick="mTab('source',this)">Source</button>
      </div>
      <div class="m-pane vis" id="pane-ingredients">
        <p class="ingr-note">Ranhofer's recipes describe ingredients within the method — quantities are listed below as they appear in the text. For precise amounts and context, read the full method or consult the original book.</p>
        <ul class="ingr-list" id="ingr-list"></ul>
      </div>
      <div class="m-pane" id="pane-method">
        <div class="mtxt ld" id="m-txt">Loading…</div>
      </div>
      <div class="m-pane" id="pane-source">
        <div class="source-info" id="src-info"></div>
      </div>
    </div>
    <div class="m-actions">
      <button class="m-act-btn" onclick="addToMenu()">+ Add to Menu</button>
      <button class="m-act-btn print-btn" onclick="printRecipe()">⎙ Print Recipe</button>
    </div>
    <div class="mnav">
      <button class="mnb" id="m-prv" onclick="mNav(-1)">← Previous</button>
      <button class="mnb" id="m-nxt" onclick="mNav(1)">Next →</button>
    </div>
  </div>
</div>

<footer id="ftr">
  <div class="fo">— ✦ —</div>
  <div class="ft"><em>The Epicurean</em> was published in 1894 by Charles Ranhofer, Chef of Delmonico's for thirty-four years. This digital archive presents all 3,186 recipes with their original French and English titles as printed in the first edition. Public domain.</div>
</footer>

<script>
// ── EMBEDDED DATA ──

const PAGE_MAP=[
  [1,182,169,239],[183,384,239,288],[385,635,288,331],
  [636,770,331,355],[771,835,355,368],[836,993,368,401],
  [994,1093,401,427],[1094,1312,427,471],[1313,1478,471,507],
  [1479,1584,507,531],[1585,1660,531,547],[1661,1770,547,569],
  [1771,1820,569,583],[1821,2045,583,637],[2046,2209,637,675],
  [2210,2408,675,723],[2409,2676,723,815],[2677,2849,815,847],
  [2850,2951,847,865],[2952,2989,865,873],[2990,3124,873,907],
  [3125,3224,907,931],[3225,3404,931,969],[3405,3424,969,977],
  [3424,3613,977,1029],[3614,3704,1029,1061],[3705,3715,1061,1068]
];
const FRONT=14;
function iaPage(id){
  for(const[rs,re,ps,pe] of PAGE_MAP){
    if(rs<=id&&id<=re){
      const ratio=(id-rs)/Math.max(1,re-rs);
      return Math.round(ps+ratio*(pe-ps))+20;
    }
  }
  return 259;
}
function iaUrl(id){return`https://archive.org/details/epicureancomplet00ranh_0/page/n${iaPage(id)}/mode/1up`}

const SEC_FR={
  'Elementary Methods':'Méthodes Élémentaires','Soups':'Potages','Sauces':'Sauces',
  'Garnishings':'Garnitures','Cold Side Dishes':"Hors-d'Œuvre Froids",
  'Hot Side Dishes':"Hors-d'Œuvre Chauds",'Mollusks and Crustaceans':'Mollusques et Crustacés',
  'Fish':'Poissons','Beef':'Bœuf','Veal':'Veau','Mutton':'Mouton','Lamb':'Agneau',
  'Pork':'Porc','Poultry':'Volaille','Game':'Gibier',
  'Miscellaneous Entrees':'Entrées Diverses','Cold Service':'Service Froid',
  'Vegetables':'Légumes','Eggs':'Œufs','Farinaceous':'Farineux',
  'Hot Sweet Entremets':'Entremets Chauds','Cold Sweet Entremets':'Entremets Froids',
  'Pastry':'Pâtisserie','Bakery':'Boulangerie','Ices':'Glaces',
  'Confectionery':'Confiserie','Wines':'Vins','Side Dishes':"Hors-d'Œuvre"
};

const TAX_DESC={
  a_la:'Preparations named for patrons, places, and classical garnishes.',
  au_aux:'Dishes defined by their primary ingredient or characteristic element.',
  en_method:'Dishes described by their vessel, form, or method of presentation.'
};

// Menu planner courses
const MENU_COURSES=[
  {id:'oysters',   label:'Oysters',          fr:'Huîtres',           sections:['Cold Side Dishes','Mollusks and Crustaceans'], on:true},
  {id:'soup',      label:'Soup',             fr:'Potage',            sections:['Soups'], on:true},
  {id:'sidedish',  label:'Side Dish',        fr:"Hors-d'Œuvre",      sections:['Hot Side Dishes','Cold Side Dishes'], on:true},
  {id:'fish',      label:'Fish',             fr:'Poisson',           sections:['Fish'], on:true},
  {id:'remove',    label:'Relevé',           fr:'Relevé',            sections:['Beef','Veal','Mutton','Lamb'], on:true},
  {id:'entree1',   label:'Entrée I',         fr:'Entrée I',          sections:['Miscellaneous Entrees','Garnishings'], on:true},
  {id:'entree2',   label:'Entrée II',        fr:'Entrée II',         sections:['Poultry','Game','Pork'], on:false},
  {id:'punch',     label:'Punch / Sorbet',   fr:'Sorbet',            sections:['Ices'], on:false},
  {id:'roast',     label:'Roast',            fr:'Rôt',               sections:['Poultry','Game'], on:true},
  {id:'cold',      label:'Cold Dish',        fr:'Pièce Froide',      sections:['Cold Service'], on:false},
  {id:'vegetable', label:'Vegetable',        fr:'Légume',            sections:['Vegetables'], on:true},
  {id:'hotsweet',  label:'Hot Entremes',     fr:'Entremets Chauds',  sections:['Hot Sweet Entremets','Eggs','Farinaceous'], on:true},
  {id:'coldsweet', label:'Cold Entremes',    fr:'Entremets Froids',  sections:['Cold Sweet Entremets','Pastry','Bakery'], on:true},
  {id:'ice',       label:'Ice / Dessert',    fr:'Glaces',            sections:['Ices','Confectionery'], on:true},
];
let menuSelections={};
let menuCustom={};  // course id -> manually added recipe

// ── Boot ─────────────────────────────────────
async function boot(){
  const bar=document.getElementById('lb'),sub=document.getElementById('ls-sub');
  try{
    let p=0;
    const spin=setInterval(()=>{p=Math.min(p+3,88);bar.style.width=p+'%'},120);
    sub.textContent='Loading archive…';
    // Fetch index from existing repo file
    const resp=await fetch('epicurean_index.json');
    if(!resp.ok) throw new Error('Could not load index ('+resp.status+')');
    clearInterval(spin);
    DB=await resp.json();
    bar.style.width='100%';
    sub.textContent=DB.recipes.length.toLocaleString()+' recipes';
    document.getElementById('stat-r').textContent=DB.recipes.length.toLocaleString();
    await new Promise(r=>setTimeout(r,300));
    document.getElementById('ls').classList.add('hidden');
    buildGrid();buildAZ();buildTax();buildMenuToggles();initSearch();
    // Load texts in background from split JSON files
    Promise.all([1,2,3,4,5,6].map(n=>
      fetch('epicurean_texts_'+n+'.json')
        .then(r=>r.ok?r.json():{})
        .catch(()=>({}))
    )).then(chunks=>chunks.forEach(c=>Object.assign(TEXTS,c)));
  }catch(e){
    document.getElementById('ls-sub').textContent='Error: '+e.message;
    console.error(e);
  }
}
function getText(id){
  return TEXTS[String(id)]||'';
}

// ── Mode switching ────────────────────────────
function setMode(m){
  mode=m;
  ['browse','search','az','tax','menu','book'].forEach(k=>{
    document.getElementById('tab-'+k)?.classList.toggle('active',k===m);
  });
  document.getElementById('browse-panel').style.display=m==='browse'?'':'none';
  document.getElementById('az-panel').classList.toggle('vis',m==='az');
  document.getElementById('tax-panel').classList.toggle('vis',m==='tax');
  document.getElementById('srch-wrap').classList.toggle('vis',m==='search');
  document.getElementById('res-panel').style.display=m==='search'?'':'none';
  document.getElementById('menu-panel').classList.toggle('vis',m==='menu');
  document.getElementById('book-panel').classList.toggle('vis',m==='book');
  if(m==='search'){setTimeout(()=>document.getElementById('srch').focus(),50);if(!document.getElementById('srch').value)document.getElementById('res-inner').innerHTML='';}
  if(m==='book')loadBookFrame();
}

// ── Utility ───────────────────────────────────
function esc(s){return(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}
function hl(s,q){if(!q)return esc(s);const e=esc(s),eq=q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');return e.replace(new RegExp('('+eq+')','gi'),'<mark>$1</mark>')}
function rand(arr){return arr[Math.floor(Math.random()*arr.length)]}

// ── Extract ingredients from prose text ───────
function extractIngredients(text){
  if(!text)return[];
  const found=new Set();
  // Numeric quantities: "2 pounds", "3/4 cup", "1/2 pint"
  const num=text.match(/\b\d+(?:[\s\/]\d+)?\s*(?:pounds?|ounces?|oz|lbs?|pints?|quarts?|qt|gills?|cups?|tablespoons?|tbsp|teaspoons?|tsp|gallons?|liters?|dozen|bunches?|slices?|pieces?|cloves?|heads?|sprigs?)\b/gi)||[];
  num.forEach(m=>found.add(m.trim()));
  // Written-out quantities
  const words=text.match(/\b(?:one|two|three|four|five|six|seven|eight|nine|ten|twelve|fifteen|twenty|thirty|forty|fifty|sixty|one hundred)\s+(?:pound|ounce|pint|quart|gill|cup|tablespoon|teaspoon|gallon|dozen|bunch|slice|piece|clove|head|sprig|liter|leaf|rib|fillet|cutlet)s?\b/gi)||[];
  words.forEach(m=>found.add(m.trim()));
  // Half/quarter quantities
  const fracs=text.match(/\b(?:half|quarter|a third|three[- ]quarters?)\s+(?:a\s+)?(?:pound|ounce|pint|quart|gill|cup|tablespoon|teaspoon|gallon|liter|dozen)s?\b/gi)||[];
  fracs.forEach(m=>found.add(m.trim()));
  // Cross-references
  const refs=text.match(/\(No\.\s*\d+\)/g)||[];
  refs.slice(0,5).forEach(m=>found.add(m.trim()));
  const arr=[...found].sort((a,b)=>a.length-b.length);
  return arr.slice(0,18);
}

// Linkify cross-references in text
function linkifyRefs(text){
  return esc(text).replace(/\(No\.\s*(\d+)\)/g,(m,n)=>`<a class="xref" onclick="openM(${n})" title="Recipe No. ${n}">(No. ${n})</a>`);
}

// ── Section grid ──────────────────────────────
function buildGrid(){
  const cnt={};DB.recipes.forEach(r=>{cnt[r.section]=(cnt[r.section]||0)+1});
  const order=['Elementary Methods','Soups','Sauces','Garnishings','Cold Side Dishes','Hot Side Dishes',
    'Mollusks and Crustaceans','Fish','Beef','Veal','Mutton','Lamb','Pork','Poultry','Game',
    'Miscellaneous Entrees','Cold Service','Vegetables','Eggs','Farinaceous',
    'Hot Sweet Entremets','Cold Sweet Entremets','Pastry','Bakery','Ices','Confectionery','Wines','Side Dishes'];
  const secs=[...new Set(DB.recipes.map(r=>r.section))];
  const sorted=order.filter(s=>secs.includes(s)).concat(secs.filter(s=>!order.includes(s)));
  document.getElementById('sgrid').innerHTML=sorted.map(s=>`
    <button class="scard" onclick="showSec('${esc(s)}')">
      <span class="sn">${esc(s)}</span>
      <span class="sfr">${esc(SEC_FR[s]||s)}</span>
      <span class="sc">${cnt[s]||0}</span>
    </button>`).join('');
}

function showSec(s){
  curRes=DB.recipes.filter(r=>r.section===s);curPg=1;
  renderIn('res-inner',`<span class="rl">${esc(s)}</span>`,curRes.length,'');
  setMode('search');
  document.getElementById('srch').value='';
  document.getElementById('srch-ct').textContent='';
  document.getElementById('frb').classList.remove('vis');
  window.scrollTo({top:document.getElementById('nav').offsetTop,behavior:'smooth'});
}

// ── Search ────────────────────────────────────
function initSearch(){
  document.getElementById('srch').addEventListener('input',e=>{
    clearTimeout(sTmr);sTmr=setTimeout(()=>doSearch(e.target.value),220);
  });
}
function doSearch(raw){
  const q=raw.trim(),ql=q.toLowerCase();
  const ct=document.getElementById('srch-ct'),bd=document.getElementById('frb');
  if(!q){document.getElementById('res-inner').innerHTML='';ct.textContent='';bd.classList.remove('vis');return}
  if(/^\d+$/.test(q)){const r=DB.recipes.find(x=>x.id===parseInt(q));curRes=r?[r]:[]}
  else{
    let fr=false;
    curRes=DB.recipes.filter(r=>{
      const en=(r.english_title||'').toLowerCase().includes(ql);
      const fr2=(r.french_title||'').toLowerCase().includes(ql);
      const tx=TEXTS[String(r.id)]?TEXTS[String(r.id)].toLowerCase().includes(ql):false;
      if(fr2&&!en)fr=true;return en||fr2||tx;
    });
    bd.classList.toggle('vis',fr);
  }
  curPg=1;
  ct.textContent=curRes.length+' result'+(curRes.length!==1?'s':'');
  renderIn('res-inner','Results',curRes.length,q);
}

// ── AZ ────────────────────────────────────────
function buildAZ(){
  const byL={};
  DB.recipes.forEach(r=>{
    const fr=(r.french_title||r.english_title||'').trim();if(!fr)return;
    const M={'À':'A','Â':'A','Ä':'A','È':'E','É':'E','Ê':'E','Î':'I','Ô':'O','Û':'U','Ù':'U','Œ':'O','Ç':'C'};
    let ch=fr[0].toUpperCase();ch=M[ch]||ch;
    if(/[A-Z]/.test(ch)){if(!byL[ch])byL[ch]=[];byL[ch].push(r);}
  });
  window._AZ=byL;
  document.getElementById('az-strip').innerHTML='ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').map(c=>`
    <button class="azb ${byL[c]?'':'empty'}" id="az-${c}" onclick="${byL[c]?`showAZ('${c}')`:''}">${c}</button>`).join('');
  const first='ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').find(c=>byL[c]);
  if(first)showAZ(first);
}
function showAZ(ch){
  document.querySelectorAll('.azb').forEach(b=>b.classList.remove('act'));
  document.getElementById('az-'+ch)?.classList.add('act');
  const recs=(window._AZ[ch]||[]).slice().sort((a,b)=>(a.french_title||'').localeCompare(b.french_title||'','fr'));
  curRes=recs;curPg=1;
  renderInEl(document.getElementById('az-res'),`<span class="rl">${ch}</span>`,recs.length,'');
}

// ── Taxonomy ──────────────────────────────────
function buildTax(){
  const T={a_la:{},au_aux:{},en_method:{}};
  DB.recipes.forEach(r=>{
    const en=(r.english_title||'').toUpperCase();
    const fr=(r.french_title||'');
    const mA=en.match(/\bA\s+L[A'E]\s*([A-ZÀÁÂÃÄÇÈÉÊËÌÍÎÏÑÒÓÔÕÖÙÚÛÜÝ][A-ZÀÁÂÃÄÇÈÉÊËÌÍÎÏÑÒÓÔÕÖÙÚÛÜÝ\s'\-]{1,28}?)(?:\s*[-,(]|$)/);
    if(mA){const mod=mA[1].trim().replace(/[-,\s]+$/,'');const n=mod[0]+mod.slice(1).toLowerCase();if(n.length>1&&n.length<34){if(!T.a_la[n])T.a_la[n]=[];T.a_la[n].push(r)}}
    const mU=fr.match(/\bau[x]?\s+([A-Za-zÀ-ÿ][A-Za-zÀ-ÿ\s\-']{1,24}?)(?:\s*[,(\n]|$)/i);
    if(mU&&!/\ba\s+l[ae']/i.test(fr)){const mod=mU[1].trim().replace(/[-,\s]+$/,'');const n=mod[0].toUpperCase()+mod.slice(1);if(n.length>1&&n.length<28){if(!T.au_aux[n])T.au_aux[n]=[];T.au_aux[n].push(r)}}
    const mE=fr.match(/\ben\s+([A-Za-zÀ-ÿ][A-Za-zÀ-ÿ\s\-']{1,24}?)(?:\s*[,(\n]|$)/i);
    if(mE&&!/\ba\s+l[ae']/i.test(fr)){const mod=mE[1].trim().replace(/[-,\s]+$/,'');const n=mod[0].toUpperCase()+mod.slice(1);if(n.length>1&&n.length<28){if(!T.en_method[n])T.en_method[n]=[];T.en_method[n].push(r)}}
  });
  window._TAX=T;setTaxTab('a_la');
}
function setTaxTab(k){
  curTax=k;
  document.querySelectorAll('.ttab').forEach(t=>t.classList.remove('act'));
  document.getElementById('tt-'+k)?.classList.add('act');
  document.getElementById('tdesc').textContent=TAX_DESC[k]||'';
  const data=window._TAX[k]||{};
  const sorted=Object.entries(data).filter(([,a])=>a.length>=1).sort((a,b)=>b[1].length-a[1].length);
  const max=sorted[0]?.[1].length||1;
  document.getElementById('mcloud').innerHTML=sorted.map(([m,a])=>{
    const r=a.length/max,cl=r>.5?'fh':r>.2?'fm':'fl';
    return`<button class="mchip ${cl}" onclick="showMod('${esc(m)}','${k}',this)">${esc(m)} <small style="opacity:.45;font-size:.72em">${a.length}</small></button>`;
  }).join('');
  document.getElementById('tax-res').innerHTML='';
}
function showMod(mod,key,el){
  document.querySelectorAll('.mchip').forEach(c=>c.classList.remove('act'));
  el.classList.add('act');
  curRes=window._TAX[key][mod]||[];curPg=1;
  renderInEl(document.getElementById('tax-res'),`<span style="font-style:italic;font-family:var(--fi)">${esc(mod)}</span>`,curRes.length,'',true);
  document.getElementById('tax-res').scrollIntoView({behavior:'smooth',block:'nearest'});
}

// ── Menu Planner ─────────────────────────────
function buildMenuToggles(){
  document.getElementById('menu-toggles').innerHTML=MENU_COURSES.map(c=>`
    <button class="menu-course-toggle ${c.on?'on':''}" id="toggle-${c.id}" onclick="toggleCourse('${c.id}',this)">
      ${esc(c.label)}
    </button>`).join('');
}
function toggleCourse(id,el){
  const c=MENU_COURSES.find(x=>x.id===id);if(!c)return;
  c.on=!c.on;el.classList.toggle('on',c.on);
}
function pickForCourse(course){
  const pool=DB.recipes.filter(r=>course.sections.includes(r.section));
  if(!pool.length)return null;
  return pool[Math.floor(Math.random()*pool.length)];
}
function generateMenu(){
  menuSelections={};
  const active=MENU_COURSES.filter(c=>c.on);
  active.forEach(c=>{
    const r=menuCustom[c.id]||pickForCourse(c);
    menuSelections[c.id]=r;
  });
  renderMenu();
  document.getElementById('btn-regen').style.display='';
  document.getElementById('btn-print-menu').style.display='';
}
function swapCourse(id){
  const c=MENU_COURSES.find(x=>x.id===id);if(!c)return;
  menuSelections[id]=pickForCourse(c);
  renderMenu();
}
function renderMenu(){
  const active=MENU_COURSES.filter(c=>c.on);
  if(!active.length){document.getElementById('menu-result').innerHTML='<div class="menu-empty">Select at least one course to generate a menu.</div>';return}
  const now=new Date();
  const dateStr=now.toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
  const menuName=(document.getElementById('menu-name-input')?.value||'').trim()||'Menu';
  let html=`
    <div class="menu-card-header">
      <span class="menu-card-title">${menuName}</span>
      <span class="menu-card-sub">${dateStr}</span>
    </div>`;
  active.forEach(c=>{
    const r=menuSelections[c.id];
    if(!r){html+=`<div class="menu-course-item"><div class="mci-label">${esc(c.label)}</div><div class="mci-content" style="opacity:.4;font-style:italic;color:var(--ivory-dim);display:flex;align-items:center">No recipe available</div></div>`;return}
    html+=`
      <div class="menu-course-item">
        <div class="mci-label">${esc(c.label)}</div>
        <div class="mci-content" onclick="openM(${r.id})">
          <span class="mci-fr">${esc(r.french_title||r.english_title)}</span>
          <span class="mci-en">${esc(r.english_title)}</span>
          <span class="mci-no">No. ${r.id} · ${esc(r.section)}</span>
        </div>
        <div class="mci-actions">
          <button class="mci-swap" onclick="swapCourse('${c.id}')">↺ Swap</button>
        </div>
      </div>`;
  });
  document.getElementById('menu-result').innerHTML=html;
}
function printMenu(){
  const el=document.getElementById('menu-result');
  if(!el.innerHTML||el.innerHTML.includes('menu-empty'))return;
  window.print();
}
// Allow adding current modal recipe to menu
function addToMenu(){
  if(curMIdx<0)return;
  const r=DB.recipes[curMIdx];
  // Find best matching course
  const c=MENU_COURSES.find(x=>x.sections.includes(r.section))||MENU_COURSES[0];
  menuCustom[c.id]=r;
  if(!menuSelections[c.id])menuSelections[c.id]=r;
  setMode('menu');closeM();
  setTimeout(()=>{
    // Highlight the course
    const items=document.querySelectorAll('.menu-course-item');
    items.forEach(i=>{if(i.querySelector('.mci-no')?.textContent.includes('No. '+r.id)){i.style.background='rgba(201,168,76,.08)';setTimeout(()=>i.style.background='',1500)}});
    document.getElementById('btn-regen').style.display='';
    document.getElementById('btn-print-menu').style.display='';
    renderMenu();
  },100);
}

// ── Book reader ───────────────────────────────
let bookLoaded=false;
function loadBookFrame(){
  if(bookLoaded)return;
  bookLoaded=true;
  const f=document.getElementById('book-frame');
  f.src='https://archive.org/embed/epicureancomplet00ranh_0';
  f.style.display='block';
  f.closest('.book-frame-wrap').querySelector('.book-loading').style.display='none';
}
function bookJump(){
  const input=prompt('Enter a recipe number (186–3715):');
  const n=parseInt(input);
  if(isNaN(n)||n<1||n>3715){alert('Please enter a valid recipe number.');return}
  const url=iaUrl(n);
  window.open(url,'_blank');
}

// ── Render helpers ─────────────────────────────
function renderIn(cid,label,count,q){renderInEl(document.getElementById(cid),label,count,q,false)}
function renderInEl(el,label,count,q,compact){
  if(!el)return;
  const tot=Math.ceil(count/PER);
  const page=curRes.slice((curPg-1)*PER,curPg*PER);
  el.innerHTML=`
    <div class="rh"><span class="rl">${label}</span><span class="rc">${count.toLocaleString()} recipe${count!==1?'s':''}</span></div>
    ${renderList(page,q,compact)}
    ${tot>1?renderPages(curPg,tot,el.id,label,count,q):''}`;
  el.querySelectorAll('.rcard').forEach(c=>c.addEventListener('click',()=>openM(parseInt(c.dataset.id))));
}
function renderList(recs,q,compact){
  if(!recs.length)return'<p style="padding:2rem;color:var(--ivory-dim);font-style:italic;text-align:center">No recipes found.</p>';
  return`<div class="rlist">${recs.map(r=>`
    <button class="rcard" data-id="${r.id}">
      <span class="rno">No. ${r.id}</span>
      <span class="rfr">${q?hl(r.french_title||r.english_title,q):esc(r.french_title||r.english_title)}</span>
      <span class="ren">${q?hl(r.english_title,q):esc(r.english_title)}</span>
      ${compact?'':'<span class="rtag">'+esc(r.section)+'</span>'}
    </button>`).join('')}</div>`;
}
function renderPages(pg,tot,eid,lbl,cnt,q){
  const ps=[];
  for(let i=1;i<=tot;i++){
    if(i===1||i===tot||(i>=pg-2&&i<=pg+2))ps.push(i);
    else if(ps[ps.length-1]!=='…')ps.push('…');
  }
  return`<div class="pages">
    <button class="pb" ${pg===1?'disabled':''} onclick="goPg(${pg-1},'${eid}','${lbl}',${cnt},'${q}')">←</button>
    ${ps.map(p=>p==='…'?'<span class="pe">…</span>':`<button class="pb ${p===pg?'act':''}" onclick="goPg(${p},'${eid}','${lbl}',${cnt},'${q}')">${p}</button>`).join('')}
    <button class="pb" ${pg===tot?'disabled':''} onclick="goPg(${pg+1},'${eid}','${lbl}',${cnt},'${q}')">→</button>
  </div>`;
}
function goPg(p,eid,lbl,cnt,q){curPg=p;renderInEl(document.getElementById(eid),lbl,cnt,q);document.getElementById(eid)?.scrollIntoView({behavior:'smooth',block:'start'})}

// ── Modal ─────────────────────────────────────
let curModalTab='ingredients';
function openM(id){
  const r=DB.recipes.find(x=>x.id===id);if(!r)return;
  curMIdx=DB.recipes.indexOf(r);
  document.getElementById('m-no').textContent='No. '+r.id;
  document.getElementById('m-fr').textContent=r.french_title||r.english_title;
  document.getElementById('m-en').textContent=r.english_title;
  document.getElementById('m-sec').textContent=r.section;
  // IA link
  const iaLink=document.getElementById('m-ia');
  iaLink.href=iaUrl(r.id);
  iaLink.textContent='View in Original Book — p.'+iaPage(r.id)+' ↗';
  // Ingredients tab
  const ingrs=extractIngredients(getText(r.id));
  const ingList=document.getElementById('ingr-list');
  if(ingrs.length){
    ingList.innerHTML=ingrs.map(i=>`<li>${esc(i)}</li>`).join('');
  }else{
    ingList.innerHTML='<li class="ingr-none">No quantities detected — read the full method for ingredients.</li>';
  }
  // Method tab
  const tx=document.getElementById('m-txt');
  const rawText=TEXTS[String(r.id)];
  if(rawText){tx.innerHTML=linkifyRefs(rawText);tx.classList.remove('ld')}
  else{
    tx.innerHTML='Loading…';tx.classList.add('ld');
    const poll=setInterval(()=>{
      const t2=TEXTS[String(r.id)];
      if(t2){tx.innerHTML=linkifyRefs(t2);tx.classList.remove('ld');
        // Refresh ingredients too
        const ingrs2=extractIngredients(t2);
        ingList.innerHTML=ingrs2.length?ingrs2.map(i=>`<li>${esc(i)}</li>`).join(''):'<li class="ingr-none">No quantities detected.</li>';
        clearInterval(poll);}
    },400);
  }
  // Source tab
  document.getElementById('src-info').innerHTML=`
    <div class="source-row"><span class="src-label">Recipe Number</span><span class="src-val">No. ${r.id}</span></div>
    <div class="source-row"><span class="src-label">Chapter</span><span class="src-val">${esc(r.section)} — ${esc(SEC_FR[r.section]||r.section)}</span></div>
    <div class="source-row"><span class="src-label">French Title</span><span class="src-val" style="font-style:italic">${esc(r.french_title||'—')}</span></div>
    <div class="source-row"><span class="src-label">English Title</span><span class="src-val">${esc(r.english_title||'—')}</span></div>
    <div class="source-row"><span class="src-label">Est. Book Page</span><span class="src-val">${iaPage(r.id)}</span></div>
    <div class="source-row">
      <span class="src-label">Original Source</span>
      <span class="src-val" style="display:flex;flex-direction:column;gap:.4rem">
        <a class="src-link" href="${esc(iaUrl(r.id))}" target="_blank" rel="noopener">Open in Internet Archive — Page ${iaPage(r.id)} ↗</a>
        <a class="src-link" href="https://archive.org/download/epicureancomplet00ranh_0/epicureancomplet00ranh_0.pdf" target="_blank" rel="noopener">Download Full PDF ↓</a>
      </span>
    </div>
    <p class="src-note">Page numbers are approximate estimates based on chapter boundaries from the original table of contents. If the page does not show this recipe, navigate a few pages forward or back.</p>`;
  // Reset to first tab
  mTab('ingredients', document.querySelector('.m-tab'));
  document.getElementById('m-prv').disabled=curMIdx===0;
  document.getElementById('m-nxt').disabled=curMIdx===DB.recipes.length-1;
  document.getElementById('mo').classList.add('open');
  document.body.style.overflow='hidden';
  document.getElementById('mdl').scrollTop=0;
}
function mTab(name, el){
  curModalTab=name;
  document.querySelectorAll('.m-tab').forEach(t=>t.classList.remove('act'));
  if(el)el.classList.add('act');
  else document.querySelectorAll('.m-tab').forEach(t=>{if(t.getAttribute('onclick')?.includes("'"+name+"'"))t.classList.add('act')});
  document.querySelectorAll('.m-pane').forEach(p=>p.classList.remove('vis'));
  document.getElementById('pane-'+name)?.classList.add('vis');
}
function closeMO(e){if(e.target===document.getElementById('mo'))closeM()}
function closeM(){document.getElementById('mo').classList.remove('open');document.body.style.overflow=''}
function mNav(d){const n=curMIdx+d;if(n<0||n>=DB.recipes.length)return;openM(DB.recipes[n].id)}
function printRecipe(){window.print()}

document.addEventListener('keydown',e=>{
  if(e.key==='Escape')closeM();
  if(!document.getElementById('mo').classList.contains('open'))return;
  if(e.key==='ArrowLeft')mNav(-1);
  if(e.key==='ArrowRight')mNav(1);
});

boot();
</script>
</body>
</html>